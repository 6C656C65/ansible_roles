services:
  caddy:
    image: caddy:2
    container_name: caddy
    restart: unless-stopped
    volumes:
      - ./Caddyfile:/etc/caddy/Caddyfile
      - ./certs/:/data/caddy/pki/authorities/local/
      - /var/log/caddy:/var/log/caddy
      - /etc/timezone:/etc/timezone:ro
      - /etc/localtime:/etc/localtime:ro
    ports:
      - "80:80"
      - "443:443"
      - "2019:2019"
{% if backend[inventory_hostname] is defined and backend[inventory_hostname] | length > 0 %}
    networks:
{% for item in backend[inventory_hostname] %}
      {{ item.network }}:
{% endfor %}
{% endif %}

{% if backend[inventory_hostname] is defined and backend[inventory_hostname] | length > 0 %}
networks:
{% for item in backend[inventory_hostname] %}
  {{ item.network }}:
    external: true
{% endfor %}
{% endif %}

volumes:
  caddy-data:
    name: caddy-data
  caddy-config:
    name: caddy-config